
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta name="format-detection" content="telephone=no"/>
    <title>无条件</title>
</head>
<body>
<h1>无条件</h1>
<p>代码<strong>改编</strong>于http://liangweibin.fe.baidu.com/audioApi/jinglebell.html</p>
<p><input type="button" id="play" value="播放！"/></p>
<script type="text/javascript">
    (function () {
        var HZ = [261.63,293.66,329.63,349.23,392.00,440.00,493.88];
        //var band = 'c  5c gedc 7  7g ggg7 6  6c ccc6 e de d75 5\
        //c  5c gedc g  cc ijii h  gg ggge d  de\
        //f ed fed ef'
        //4j4c454i1e3e46271e1e17261h1c3145261c1c16251j1i3i4e4g1e1d2\
        var band = 'c8 251c1g1e1d1c178 271g1g1g1g17168 261c1c1c1c161e4 2c1e1d1715254\
        c8 251c1g1e1d1c1g8 2c1c1i1j1i1i1h8 2g1g1g1g1g1e1d8 4d2e2\
        f4e2d2f2e1d1 2e1f1e2d2d2c2e2d1c1 1c1d1e1d2c2c272d2c171 171c1d1c272c2d1e1e4 2d1e1\
        f4f2d2h2f1d1 1h1i1j1i2h2h2e2j2i1h1 1h1i1j1i6h2h6g2g2h2i8 2l2e2g2\
        k1l2l1l4 2l2e2g2k1l2l1l4 2l2n2l2l1m2m1 3h1l1m2m1m2h2g8 2l2e2g2\
        k1l2l1l4 2l2k2j2i1n2n1n4 2n2m2l2n1m2m1 3l1n1m2m1m2h2l8 2k1l1n1l1k1j1\
        j8 2d1e1g1e1d1c178 271e1e1726168 261c1c1625158 2e1g1g1e2d1\
        c8 251c1g1e1d1c178 271g1g1g1g17168 261c1c1c1c161e4 2c1e1d1715254\
        c8 251c1g1e1d1c1g8 2c1c1i1j1i1i1h8 2g1g1g1g1g1e1d8 4d2e2\
        f4e2d2f2e1d1 2e1f1e2d2d2c2e2d1c1 1c1d1e1d2c2c272d2c171 171c1d1c272c2d1e1e4 2d1e1\
        f4f2d2h2f1d1 1h1i1j1i2h2h2e2j2i1h1 1h1i1j1i6h2h6g2g2h2i8 2l2e2g2\
        k1l2l1l4 2l2e2g2k1l2l1l4 2l2n2l2l1m2m1 3h1l1m2m1m2h2g8 2l2e2g2\
        k1l2l1l4 2l2k2j2i1n2n1n4 2n2m2l2n1m2m1 3l1n1m2m1m2h2l8 2k1l1n1l1k1j1\
        j8'
      
        var SQUARE_DURATION = 0.2;
        var TRIANGLE_DURATION = 0.185;
        var NOTE_DURATION = 0.2;

        var Ctx = window.webkitAudioContext ? window.webkitAudioContext : window.AudioContext;
        var ctx = new Ctx();
        var compressor = ctx.createDynamicsCompressor();
        compressor.connect(ctx.destination);

        function playNote(chr, type, octave, startTime, durateCnt) {
            if (chr === ' ') {
                return;
            }
            var oscillator = ctx.createOscillator();
            if ('j' <= chr && chr <= 'p'){
                oscillator.frequency.value = HZ[chr.charCodeAt(0) - 'j'.charCodeAt(0)] * octave * 2
            } else if ('c' <= chr && chr <= 'i') {
                oscillator.frequency.value = HZ[chr.charCodeAt(0) - 'c'.charCodeAt(0)] * octave;
            } else if ('1' <= chr && chr <= '7') {
                oscillator.frequency.value = HZ[chr.charCodeAt(0) - '1'.charCodeAt(0)] * octave / 2;
            }
            oscillator.type = type;
            if (type === 'triangle') {
                oscillator.start(startTime);
                oscillator.stop(startTime + TRIANGLE_DURATION * durateCnt);
                oscillator.connect(compressor);
            } else if (type === 'square') {
                oscillator.start(startTime);
                oscillator.stop(startTime + SQUARE_DURATION * durateCnt);
                var gainNode = ctx.createGain();
                gainNode.gain.value = 1.0;
                gainNode.gain.linearRampToValueAtTime(1.0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.0, startTime + SQUARE_DURATION * durateCnt);
                oscillator.connect(gainNode);
                gainNode.connect(compressor);
            }
        }

        function playBandString(bandStr, type, octave, startTime) {
            var i, len;
            var total_time = 0;
            for (i = 0, len = bandStr.length; i < len/2; i ++) {
                console.log(bandStr.charAt(2*i), bandStr.charAt(2*i+1), total_time)
                playNote(bandStr.charAt(2*i), type, octave, startTime + total_time, bandStr.charAt(2*i+1));
                total_time += bandStr.charAt(2*i+1) * NOTE_DURATION
            }
        }

        document.getElementById('play').onclick = function () {
            playBandString(band, 'triangle', 2, ctx.currentTime + 0.1);
        };
    })();
</script>
</body>
</html>
